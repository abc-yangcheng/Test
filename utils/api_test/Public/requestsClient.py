# -*- coding: utf-8 -*-# @Project : apiTest# @File    : requestsClient.py# @Date    : 2019-11-29# @Author  : hutong# @Describe: 微信公众： 大话性能import requestsimport jsonfrom logUtil.mylog import Logfrom retrying import retrymylogger = Log(__name__).getlogger()class requestUtil():    def __init__(self,data_type):        if data_type == 'xml':            self.data_type = data_type            # xml格式            self.headers = {"Content-Type": "text/xml",                "User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:51.0) Gecko/20100101 Firefox/51.0"}        # json格式        if data_type =='json':            #print('11111111')            self.data_type = data_type            self.headers = {"Content-Type": "application/json",                "User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:51.0) Gecko/20100101 Firefox/51.0"}    @retry(stop_max_attempt_number=3,wait_random_min=1,wait_random_max=5)    def get(self, url,params):#get请求        try:            r = requests.get(url, params=params,headers=self.headers)            r.encoding = 'UTF-8'            json_response = json.loads(r.text)            return {'get_code':0,'result':json_response}        except Exception as e:            mylogger.error('get请求出错，出错原因: {}'.format(e), exc_info=True)            return {'get_code': 1, 'result': 'get请求出错，出错原因:%s'%e}    @retry(stop_max_attempt_number=3, wait_random_min=1, wait_random_max=5)    def post(self, url, params):#post请求        #if self.data_type == 'json':            #print ('2222222')            #params = json.dumps(params) #dumps 转化为json        #print(params)        #print('data: {}, type: {}'.format(data, type(data)))        try:            r =requests.post(url,params,headers=self.headers)            #print(r.text,type(r.text))            json_response = json.loads(r.text)            #print(json_response)            return {'post_code': 0, 'result': json_response}        except Exception as e:            mylogger.error('post请求出错，出错原因: {}'.format(e), exc_info=True)            return {'post_code': 1, 'result': 'post请求出错，出错原因:%s' % e}    @retry(stop_max_attempt_number=3, wait_random_min=1, wait_random_max=5)    def putfile(self,url,params):#put请求        try:            data=json.dumps(params)            me=requests.put(url,data)            json_response=json.loads(me.text)            return {'code': 0, 'result': json_response}        except Exception as e:            mylogger.error('put请求出错，出错原因: {}' .format(e), exc_info=True)            return {'code': 1, 'result': 'put请求出错，出错原因:%s' % e}    """    data = '''<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:user="UserService">       <soapenv:Header/>       <soapenv:Body>          <user:addUser>             <!--Optional:-->             <user:name>张三</user:name>             <!--Optional:-->             <user:password>123456</user:password>          </user:addUser>       </soapenv:Body>    </soapenv:Envelope>    '''.encode('utf-8')    """if __name__ == "__main__":    url = 'http://127.0.0.1:6868/dahuaxingneng/test'    params = {'password': '1223', 'user_id': 2}    data_json = json.dumps(params)  # dumps：将python对象解码为json数据    #requests.post(url,data_json)    requestUtil('json').post(url,params)